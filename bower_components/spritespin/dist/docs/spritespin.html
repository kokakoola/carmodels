<!DOCTYPE html>

<html>
<head>
  <title>spritespin.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="spritespin.api.html">
                spritespin.api.js
              </a>
            
              
              <a class="source" href="spritespin.beh-click.html">
                spritespin.beh-click.js
              </a>
            
              
              <a class="source" href="spritespin.beh-drag.html">
                spritespin.beh-drag.js
              </a>
            
              
              <a class="source" href="spritespin.beh-hold.html">
                spritespin.beh-hold.js
              </a>
            
              
              <a class="source" href="spritespin.beh-swipe.html">
                spritespin.beh-swipe.js
              </a>
            
              
              <a class="source" href="spritespin.html">
                spritespin.js
              </a>
            
              
              <a class="source" href="spritespin.mod-360.html">
                spritespin.mod-360.js
              </a>
            
              
              <a class="source" href="spritespin.mod-gallery.html">
                spritespin.mod-gallery.js
              </a>
            
              
              <a class="source" href="spritespin.mod-panorama.html">
                spritespin.mod-panorama.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>spritespin.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
(<span class="function"><span class="keyword">function</span><span class="params">($)</span> {</span>
  <span class="string">"use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>The SpriteSpin object. This object wraps the core logic of SpriteSpin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Spin = window.SpriteSpin = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>The namespace that is used for data storage and events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> name = Spin.namespace = <span class="string">'spritespin'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Event names that are recognized by SpriteSpin. A module may implement any of these and they will be bound
to the target element on which the plugin is called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> modEvents = [
    <span class="string">'mousedown'</span>, <span class="string">'mousemove'</span>, <span class="string">'mouseup'</span>, <span class="string">'mouseenter'</span>, <span class="string">'mouseover'</span>, <span class="string">'mouseleave'</span>, <span class="string">'dblclick'</span>,
    <span class="string">'touchstart'</span>, <span class="string">'touchmove'</span>, <span class="string">'touchend'</span>, <span class="string">'touchcancel'</span>,
    <span class="string">'selectstart'</span>, <span class="string">'gesturestart'</span>, <span class="string">'gesturechange'</span>, <span class="string">'gestureend'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Collection of modules that can be used to extend the functionality of SpriteSpin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.mods = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Default set of SpriteSpin options. This also represents the majority of data attributes that are used during the
lifetime of a SpriteSpin instance. The data is stored inside the target DOM element on which the plugin is called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.defaults = {
    source            : <span class="literal">undefined</span>,    <span class="comment">// Stitched source image or array of files</span>
    width             : <span class="literal">undefined</span>,    <span class="comment">// actual display width</span>
    height            : <span class="literal">undefined</span>,    <span class="comment">// actual display height</span>
    frames            : <span class="literal">undefined</span>,    <span class="comment">// Total number of frames</span>
    framesX           : <span class="literal">undefined</span>,    <span class="comment">// Number of frames in one row of sprite sheet (if source is a spritesheet)</span>
    lanes             : <span class="number">1</span>,

    module            : <span class="string">'360'</span>,        <span class="comment">// The presentation module to use</span>
    behavior          : <span class="string">'drag'</span>,       <span class="comment">// The interaction module to use</span>
    renderer          : <span class="string">'canvas'</span>,     <span class="comment">// The rendering mode to use</span>

    lane              : <span class="number">0</span>,            <span class="comment">//</span>
    frame             : <span class="number">0</span>,            <span class="comment">// Initial (and current) frame number</span>
    frameTime         : <span class="number">40</span>,           <span class="comment">// Time between updates. Set to 40 which is 25 frames per second</span>
    animate           : <span class="literal">true</span>,         <span class="comment">// Runs animation</span>
    reverse           : <span class="literal">false</span>,        <span class="comment">// If true animation is played backward</span>
    loop              : <span class="literal">true</span>,         <span class="comment">// Loops the animation</span>
    stopFrame         : <span class="number">0</span>,            <span class="comment">// Stops the animation at this frame if loop is disabled</span>

    wrap              : <span class="literal">true</span>,         <span class="comment">// Same as 'loop' but for user interaction</span>
    wrapLane          : <span class="literal">false</span>,        <span class="comment">//</span>
    sense             : <span class="number">1</span>,            <span class="comment">// Interaction sensitivity used by behavior implementations</span>
    senseLane         : <span class="literal">undefined</span>,    <span class="comment">// Interaction sensitivity used by behavior implementations</span>
    orientation       : <span class="string">'horizontal'</span>, <span class="comment">//</span>

    onInit            : <span class="literal">undefined</span>,    <span class="comment">// Occurs when plugin has been initialized, but before loading the source files</span>
    onProgress        : <span class="literal">undefined</span>,    <span class="comment">// Occurs when any source file has been loaded</span>
    onLoad            : <span class="literal">undefined</span>,    <span class="comment">// Occurs when all source files have been loaded</span>
    onFrame           : <span class="literal">undefined</span>,    <span class="comment">// Occurs when the frame number has been updated (e.g. during animation)</span>
    onDraw            : <span class="literal">undefined</span>     <span class="comment">// Occurs when all update is complete and frame can be drawn</span>
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="internal-helper-functions">Internal Helper Functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>converts the given number to string and pads it to match at least the given length.
The pad value is added in front of the string. This padNumber(4, 5, 0) would convert 4 to &#39;00004&#39;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">padNumber</span><span class="params">(num, length, pad)</span>{</span>
    num = String(num);
    <span class="keyword">while</span> (num.length &lt; length){
      num = String(pad) + num;
    }
    <span class="keyword">return</span> num;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>clamps the given value by the given min and max values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">clamp</span><span class="params">(value, min, max)</span>{</span>
    <span class="keyword">return</span> (value &gt; max ? max : (value &lt; min ? min : value));
  }

  <span class="function"><span class="keyword">function</span> <span class="title">wrap</span><span class="params">(value, min, max, size)</span>{</span>
    <span class="keyword">while</span> (value &gt; max){ value -= size; }
    <span class="keyword">while</span> (value &lt; min){ value += size; }
    <span class="keyword">return</span> value;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>prevents default action on the given event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">prevent</span><span class="params">(e)</span>{</span>
    e.preventDefault();
    <span class="keyword">return</span> <span class="literal">false</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Binds on the given target and event the given function.
The SpriteSpin namespace is attached to the event name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">bind</span><span class="params">(target, event, func)</span>{</span>
    <span class="keyword">if</span> (func) {
      target.bind(event + <span class="string">'.'</span> + name, func);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Unbinds all SpriteSpin events from given target element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">unbind</span><span class="params">(target)</span>{</span>
    target.unbind(<span class="string">'.'</span> + name);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Loads a set of image files. Yields the progress and the completion of the load operation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">(opts)</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>convert opts.source to an array of strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> src = (<span class="keyword">typeof</span> opts.source === <span class="string">'string'</span>) ? [opts.source] : opts.source;
    <span class="keyword">var</span> i, count = <span class="number">0</span>, img, images = [];
    <span class="keyword">var</span> tick = <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
      count += <span class="number">1</span>;
      <span class="keyword">if</span> (<span class="keyword">typeof</span> opts.progress === <span class="string">'function'</span>){
        opts.progress({
          loaded: count,
          total: src.length,
          percent: Math.round((count / src.length) * <span class="number">100</span>)
        });
      }
      <span class="keyword">if</span> (count === images.length &amp;&amp; <span class="keyword">typeof</span> opts.complete === <span class="string">'function'</span>) {
        opts.complete(images);
      }
    };
    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; src.length; i += <span class="number">1</span> ) {
      img = <span class="keyword">new</span> Image();
      images.push(img);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>currently no care about error or aborting transfers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      img.onload = img.onabort = img.onerror = tick;
      img.src = src[i];
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2 id="public-helper-functions">Public Helper Functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Generates an array of source strings</p>
<ul>
<li>path is a source string where the frame number of the file name is exposed as &#39;{frame}&#39;</li>
<li>start indicates the first frame number</li>
<li>end indicates the last frame number</li>
<li>digits is the number of digits used in the file name for the frame number</li>
</ul>
<p>example:
     sourceArray(&#39;<a href="http://example.com/image_{frame}.jpg">http://example.com/image_{frame}.jpg</a>, { frame: [1, 3], digits: 2 })
     // -&gt; [ &#39;<a href="http://example.com/image_01.jpg">http://example.com/image_01.jpg</a>&#39;, &#39;<a href="http://example.com/image_02.jpg">http://example.com/image_02.jpg</a>&#39;, &#39;<a href="http://example.com/image_03.jpg">http://example.com/image_03.jpg</a>&#39; ]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.sourceArray = <span class="function"><span class="keyword">function</span><span class="params">(path, opts)</span>{</span>
    <span class="keyword">var</span> fStart = <span class="number">0</span>, fEnd = <span class="number">0</span>, lStart = <span class="number">0</span>, lEnd = <span class="number">0</span>, digits = opts.digits || <span class="number">2</span>;
    <span class="keyword">if</span> (opts.frame) {
      fStart = opts.frame[<span class="number">0</span>];
      fEnd = opts.frame[<span class="number">1</span>];
    }
    <span class="keyword">if</span> (opts.lane) {
      lStart = opts.lane[<span class="number">0</span>];
      lEnd = opts.lane[<span class="number">1</span>];
    }
    <span class="keyword">var</span> i, j, temp, result = [];
    <span class="keyword">for</span> (i = lStart; i &lt;= lEnd; i+=<span class="number">1</span>){
      <span class="keyword">for</span> (j = fStart; j &lt;= fEnd; j+=<span class="number">1</span>){
        temp = path.replace(<span class="string">"{lane}"</span>, padNumber(i, digits, <span class="number">0</span>));
        temp = temp.replace(<span class="string">"{frame}"</span>, padNumber(j, digits, <span class="number">0</span>));
        result.push(temp);
      }
    }
    <span class="keyword">return</span> result;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Measures the image frames that are used in the given data object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.measureSource = <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
    <span class="keyword">if</span> (data.images.length === <span class="number">1</span>){
      data.sourceWidth = data.images[<span class="number">0</span>].width;
      data.sourceHeight = data.images[<span class="number">0</span>].height;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>calculate the number of frames packed in a row
assume tightly packed images without any padding pixels</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      data.framesX = data.framesX || data.frames;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>calculate size of a single frame</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (!data.frameWidth || !data.frameHeight){
        <span class="keyword">if</span> (data.framesX){
          data.frameWidth = Math.floor(data.sourceWidth / data.framesX);
          <span class="keyword">var</span> framesY = Math.ceil((data.frames * data.lanes) / data.framesX);
          data.frameHeight = Math.floor(data.sourceHeight / framesY);
        } <span class="keyword">else</span> {
          data.frameWidth = data.images[<span class="number">0</span>].width;
          data.frameHeight = data.images[<span class="number">0</span>].height;
        }
      }
    } <span class="keyword">else</span> {
      data.sourceWidth = data.frameWidth = data.images[<span class="number">0</span>].width;
      data.sourceHeight = data.frameHeight = data.images[<span class="number">0</span>].height;
      data.frames = data.frames || data.images.length;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Resets the input state of the SpriteSpin data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.resetInput = <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
    data.startX = data.startY = <span class="literal">undefined</span>;      <span class="comment">// initial touch/click position</span>
    data.currentX = data.currentY = <span class="literal">undefined</span>;  <span class="comment">// touch/click position in current frame</span>
    data.oldX = data.oldY = <span class="literal">undefined</span>;          <span class="comment">// touch/click position in last frame</span>
    data.dX = data.dY = data.dW = <span class="number">0</span>;            <span class="comment">// drag direction from start to current frame</span>
    data.ddX = data.ddY = data.ddW = <span class="number">0</span>;         <span class="comment">// drag direction from previous to current frame</span>
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Updates the input state of the SpriteSpin data using the given mouse or touch event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.updateInput = <span class="function"><span class="keyword">function</span><span class="params">(e, data)</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>jQuery Event normalization does not preserve the &#39;event.touches&#39;
try to grab touches from the original event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (e.touches === <span class="literal">undefined</span> &amp;&amp; e.originalEvent !== <span class="literal">undefined</span>){
      e.touches = e.originalEvent.touches;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>cache positions from previous frame</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    data.oldX = data.currentX;
    data.oldY = data.currentY;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>get current touch or mouse position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (e.touches !== <span class="literal">undefined</span> &amp;&amp; e.touches.length &gt; <span class="number">0</span>){
      data.currentX = e.touches[<span class="number">0</span>].clientX;
      data.currentY = e.touches[<span class="number">0</span>].clientY;
    } <span class="keyword">else</span> {
      data.currentX = e.clientX;
      data.currentY = e.clientY;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Cache the initial click/touch position and store the frame number at which the click happened.
Useful for different behavior implementations. This must be restored when the click/touch is released.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (data.startX === <span class="literal">undefined</span> || data.startY === <span class="literal">undefined</span>){
      data.startX = data.currentX;
      data.startY = data.currentY;
      data.clickframe = data.frame;
      data.clicklane = data.lane;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Calculate the vector from start position to current pointer position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    data.dX = data.currentX - data.startX;
    data.dY = data.currentY - data.startY;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Calculate the vector from last frame position to current pointer position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    data.ddX = data.currentX - data.oldX;
    data.ddY = data.currentY - data.oldY;

    data.ndX = data.dX / data.width;
    data.ndY = data.dY / data.height;

    data.nddX = data.ddX / data.width;
    data.nddY = data.ddY / data.height;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Updates the frame number of the SpriteSpin data. Performs an auto increment if no frame number is given.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.updateFrame = <span class="function"><span class="keyword">function</span><span class="params">(data, frame, lane)</span>{</span>

    <span class="keyword">if</span> (frame !== <span class="literal">undefined</span>){
      data.frame = Number(frame);
    } <span class="keyword">else</span> <span class="keyword">if</span> (data.animation) {
      data.frame += (data.reverse ? -<span class="number">1</span> : <span class="number">1</span>);
    }

    <span class="keyword">if</span> (data.animation){</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>wrap the frame value to fit in range [0, data.frames]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      data.frame = wrap(data.frame, <span class="number">0</span>, data.frames - <span class="number">1</span>, data.frames);</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>stop animation if loop is disabled and the stopFrame is reached</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (!data.loop &amp;&amp; (data.frame === data.stopFrame)){
        data.animate = <span class="literal">false</span>;
        Spin.stopAnimation(data);
      }
    } <span class="keyword">else</span> <span class="keyword">if</span> (data.wrap){</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>wrap/clamp the frame value to fit in range [0, data.frames]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      data.frame = wrap(data.frame, <span class="number">0</span>, data.frames - <span class="number">1</span>, data.frames);
    } <span class="keyword">else</span> {
      data.frame = clamp(data.frame, <span class="number">0</span>, data.frames - <span class="number">1</span>);
    }
    <span class="keyword">if</span> (lane !== <span class="literal">undefined</span>){
      data.lane = lane;
      data.lane = clamp(data.lane, <span class="number">0</span>, data.lanes - <span class="number">1</span>);
    }

    data.target.trigger(<span class="string">"onFrame"</span>, data);
    data.target.trigger(<span class="string">"onDraw"</span>, data);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Stops the running animation on given SpriteSpin data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.stopAnimation = <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
    <span class="keyword">if</span> (data.animation){
      window.clearInterval(data.animation);
      data.animation = <span class="literal">null</span>;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Starts animation on given SpriteSpin data if animation is enabled.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.setAnimation = <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
    Spin.stopAnimation(data);
    <span class="keyword">if</span> (data.animate){
      data.animation = window.setInterval(<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
        <span class="keyword">try</span> {
          Spin.updateFrame(data);
        } <span class="keyword">catch</span>(ignore){</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>The try catch block is a hack for Opera Browser
Opera sometimes rises an exception here and
stops performing the script</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
      }, data.frameTime);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Reads the module names on given SpriteSpin data and adds actual module implementations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.setModules = <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
    <span class="keyword">var</span> i, name, mod;
    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; data.mods.length; i += <span class="number">1</span>){
      name = data.mods[i];
      <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">'string'</span>){
        mod = Spin.mods[name];
        <span class="keyword">if</span> (!mod){
          $.error(<span class="string">"No module found with name "</span> + name);
        } <span class="keyword">else</span> {
          data.mods[i] = mod;
        }
      }
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Applies css attributes to layout the SpriteSpin containers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.setLayout = <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>disable selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    data.target
      .attr(<span class="string">'unselectable'</span>, <span class="string">'on'</span>)
      .css({
        <span class="string">'-ms-user-select'</span>: <span class="string">'none'</span>,
        <span class="string">'-moz-user-select'</span>: <span class="string">'none'</span>,
        <span class="string">'-khtml-user-select'</span>: <span class="string">'none'</span>,
        <span class="string">'-webkit-user-select'</span>: <span class="string">'none'</span>,
        <span class="string">'user-select'</span>: <span class="string">'none'</span>
      });

    <span class="keyword">var</span> w = Math.floor(data.width || data.frameWidth || data.target.innerWidth());
    <span class="keyword">var</span> h = Math.floor(data.height || data.frameHeight || data.target.innerHeight());
    data.target.css({
      width    : w,
      height   : h,
      position : <span class="string">'relative'</span>,
      overflow : <span class="string">'hidden'</span>
    });

    <span class="keyword">var</span> css = {
      width    : <span class="string">'100%'</span>,
      height   : <span class="string">'100%'</span>,
      top      : <span class="number">0</span>,
      left     : <span class="number">0</span>,
      bottom   : <span class="number">0</span>,
      right    : <span class="number">0</span>,
      position : <span class="string">'absolute'</span>
    };
    data.stage.css(css).hide();
    <span class="keyword">if</span> (data.canvas){
      data.canvas[<span class="number">0</span>].width = w;
      data.canvas[<span class="number">0</span>].height = h;
      data.canvas.css(css).hide();
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Binds all SpriteSpin events on the target element of the given SpriteSpin data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.setEvents = <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
    <span class="keyword">var</span> i, j, mod, target = data.target;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Clear all SpriteSpin events on the target element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    unbind(target);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>disable all default browser behavior on the following events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; modEvents.length; j += <span class="number">1</span>){
      bind(target, modEvents[j],  prevent);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Bind module functions to SpriteSpin events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; data.mods.length; i += <span class="number">1</span>){
      mod = data.mods[i];

      <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; modEvents.length; j += <span class="number">1</span>){
        bind(target, modEvents[j],  mod[modEvents[j]]);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>bind</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      bind(target, <span class="string">'onInit'</span>,  mod.onInit);
      bind(target, <span class="string">'onLoad'</span>,  mod.onLoad);
      bind(target, <span class="string">'onFrame'</span>, mod.onFrame);
      bind(target, <span class="string">'onDraw'</span>,  mod.onDraw);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>bind auto start function to load event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    bind(target, <span class="string">'onLoad'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e, data)</span>{</span>
      Spin.setAnimation(data);
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>bind all user events that have been passed on initialization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    bind(target, <span class="string">'onInit'</span>,     data.onInit);
    bind(target, <span class="string">'onProgress'</span>, data.onProgress);
    bind(target, <span class="string">'onLoad'</span>,     data.onLoad);
    bind(target, <span class="string">'onFrame'</span>,    data.onFrame);
    bind(target, <span class="string">'onDraw'</span>,     data.onDraw);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Performs the first time boot process: module initialization, layouting, event binding etc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.boot = <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
    Spin.setModules(data);
    Spin.setLayout(data);
    Spin.setEvents(data);
    data.target.addClass(<span class="string">'loading'</span>).trigger(<span class="string">'onInit'</span>, data);
    load({
      source: data.source,
      progress: <span class="function"><span class="keyword">function</span><span class="params">(progress)</span>{</span>
        data.target.trigger(<span class="string">'onProgress'</span>, progress);
      },
      complete: <span class="function"><span class="keyword">function</span><span class="params">(images)</span>{</span>
        data.images = images;
        Spin.measureSource(data);
        data.stage.show();
        data.target
          .removeClass(<span class="string">'loading'</span>)
          .trigger(<span class="string">'onLoad'</span>, data)
          .trigger(<span class="string">'onFrame'</span>, data)
          .trigger(<span class="string">'onDraw'</span>, data);
      }
    });
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>SpriteSpin constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.create = <span class="function"><span class="keyword">function</span><span class="params">(options)</span>{</span>
    <span class="keyword">var</span> $<span class="keyword">this</span> = options.target;
    <span class="keyword">var</span> data  = $<span class="keyword">this</span>.data(name);

    <span class="keyword">if</span> (!data){</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>SpriteSpin is not initialized
Create default settings object and extend with given options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      data = $.extend({}, Spin.defaults, options);</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>ensure that there is anything set as a source</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      data.source = data.source || [];</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>if image tags are contained inside this DOM element
use these images as the source files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $<span class="keyword">this</span>.find(<span class="string">'img'</span>).each(<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
        data.source.push($(<span class="keyword">this</span>).attr(<span class="string">'src'</span>));
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>build inner html</p>
<div>
  <div class='spritespin-stage'></div>
  <canvas class='spritespin-canvas'></canvas>
</div>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $<span class="keyword">this</span>
        .empty()
        .addClass(<span class="string">"spritespin-instance"</span>)
        .append(<span class="string">"&lt;div class='spritespin-stage'&gt;&lt;/div&gt;"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>add the canvas element if canvas rendering is enabled and supported</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (data.renderer === <span class="string">'canvas'</span>){
        <span class="keyword">var</span> canvas = $(<span class="string">"&lt;canvas class='spritespin-canvas'&gt;&lt;/canvas&gt;"</span>)[<span class="number">0</span>];
        <span class="keyword">if</span> (!!(canvas.getContext &amp;&amp; canvas.getContext(<span class="string">'2d'</span>))){
          data.canvas = $(canvas);
          data.context = canvas.getContext(<span class="string">"2d"</span>);
          $<span class="keyword">this</span>.append(data.canvas);
          $<span class="keyword">this</span>.addClass(<span class="string">'with-canvas'</span>);
        } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>fallback to image rendering mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          data.renderer = <span class="string">'image'</span>;
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>setup references to DOM elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      data.target = $<span class="keyword">this</span>;
      data.stage = $<span class="keyword">this</span>.find(<span class="string">".spritespin-stage"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>store the data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $<span class="keyword">this</span>.data(name, data);
    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>just update the data object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.extend(data, options);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>convert string source to array of strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (<span class="keyword">typeof</span> data.source === <span class="string">'string'</span>){
      data.source = [data.source];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>behavior and module attributes tell us what additional modules must be loaded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (data.behavior || data.module){
      data.mods = [];
      <span class="keyword">if</span> (data.behavior){
        data.mods.push(data.behavior);
      }
      <span class="keyword">if</span> (data.module){
        data.mods.push(data.module);
      }

      <span class="keyword">delete</span> data.behavior;
      <span class="keyword">delete</span> data.module;
    }

    Spin.boot(data);
  };

  Spin.destroy = <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
    <span class="keyword">if</span> (data){
      Spin.stopAnimation(data);
      unbind(data.target);
      data.target.removeData(name);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Helper method to register a module as an available extension to SpriteSpin.
Use this to add custom Rendering or Updateing modules that can be addressed with the
&#39;module&#39; option.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.registerModule = <span class="function"><span class="keyword">function</span><span class="params">(name, module)</span>{</span>
    <span class="keyword">if</span> (Spin.mods[name]){
      $.error(<span class="string">'Module name is already taken: '</span> + name);
    }
    module = module || {};
    Spin.mods[name] = module;
    <span class="keyword">return</span> module;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Api constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.Api = <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
    <span class="keyword">this</span>.data = data;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Helper method that allows to extend the api with more methods.
Receives an object with named functions that are extensions to the API.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spin.extendApi = <span class="function"><span class="keyword">function</span><span class="params">(methods)</span>{</span>
    <span class="keyword">var</span> key, api = Spin.Api.prototype;
    <span class="keyword">for</span>(key <span class="keyword">in</span> methods) {
      <span class="keyword">if</span> (methods.hasOwnProperty(key)) {
        <span class="keyword">if</span> (api[key]){
          $.error(<span class="string">'API method is already defined: '</span> + key);
        } <span class="keyword">else</span> {
          api[key] = methods[key];
        }
      }
    }
    <span class="keyword">return</span> api;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Expose the spritespin method to jquery
Receives an object with initialization options or a method name
The name can be one of [data|api].</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $.fn.spritespin = <span class="function"><span class="keyword">function</span><span class="params">(obj)</span> {</span>
    <span class="keyword">if</span> (obj === <span class="string">"data"</span>){
      <span class="keyword">return</span> <span class="keyword">this</span>.data(name);
    }
    <span class="keyword">if</span> (obj === <span class="string">"api"</span>){
      <span class="keyword">return</span> <span class="keyword">new</span> Spin.Api(<span class="keyword">this</span>.data(name));
    }
    <span class="keyword">if</span> (obj === <span class="string">"destroy"</span>){
      <span class="keyword">return</span> $(<span class="keyword">this</span>).each(<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
        Spin.destroy($(<span class="keyword">this</span>).data(name));
      });
    }
    <span class="keyword">if</span> (<span class="keyword">typeof</span> obj === <span class="string">'object'</span>) {
      obj.target = obj.target || $(<span class="keyword">this</span>);
      <span class="keyword">return</span> Spin.create(obj);
    }

    <span class="keyword">return</span> $.error( <span class="string">'Invalid call to spritespin'</span> );
  };

}(window.jQuery || window.Zepto || window.$));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
