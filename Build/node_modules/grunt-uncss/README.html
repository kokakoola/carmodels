<h1>grunt-uncss <a href="http://gruntjs.com/"><img src="https://cdn.gruntjs.com/builtwith.png" alt="Built with Grunt" /></a></h1>

<p><a href="http://badge.fury.io/js/grunt-uncss"><img src="https://badge.fury.io/js/grunt-uncss.svg" alt="NPM version" /></a>
<a href="https://travis-ci.org/addyosmani/grunt-uncss"><img src="https://travis-ci.org/addyosmani/grunt-uncss.svg?branch=master" alt="Build Status" /></a>
<a href="https://david-dm.org/addyosmani/grunt-uncss"><img src="https://david-dm.org/addyosmani/grunt-uncss.svg" alt="Dependency Status" /></a>
<a href="https://david-dm.org/addyosmani/grunt-uncss#info=devDependencies"><img src="https://david-dm.org/addyosmani/grunt-uncss/dev-status.svg" alt="devDependency Status" /></a></p>

<blockquote>
  <p>A grunt task for removing unused CSS from your projects with <a href="https://github.com/giakki/uncss">UnCSS</a>. Works across multiple files and supports dynamically injected CSS via PhantomJS.</p>
</blockquote>

<h2>Preview</h2>

<p>Taking a multi-page project using Bootstrap with &gt;120KB of CSS down to 11KB.</p>

<p><img src="http://i.imgur.com/uhWMALH.gif" alt="Demo" /></p>

<h2>Getting Started</h2>

<p>This plugin requires Grunt <code>~0.4.0</code></p>

<p>If you haven’t used <a href="http://gruntjs.com/">Grunt</a> before, be sure to check out the
<a href="http://gruntjs.com/getting-started">Getting Started</a> guide, as it explains how to create
a <a href="http://gruntjs.com/sample-gruntfile">Gruntfile</a> as well as install and use Grunt plugins.
Once you’re familiar with that process, you may install this plugin with this command:</p>

<p><code>shell
npm install grunt-uncss --save-dev
</code></p>

<p>Once the plugin has been installed, it may be enabled inside your Gruntfile with this line of JavaScript:</p>

<p><code>js
grunt.loadNpmTasks('grunt-uncss');
</code></p>

<h2>Uncss task</h2>

<p><em>Run this task with the <code>grunt uncss</code> command.</em></p>

<p>Task targets, files and options may be specified according to the grunt <a href="http://gruntjs.com/configuring-tasks">Configuring tasks</a> guide.</p>

<h3>Usage</h3>

<p>Use the <code>grunt-uncss</code> task by specifying a target destination (file) for your cleaned CSS.
Below this is <code>dist/css/tidy.css</code>.</p>

<p>Along-side, specify the input HTML files you would like scanned for used selectors.
In this case <code>app/index.html</code> and <code>app/about.html</code> are the two files we would like checked.</p>

<p><code>js
uncss: {
  dist: {
    files: {
      'dist/css/tidy.css': ['app/index.html', 'app/about.html']
    }
  }
}
</code></p>

<p>Which you can then use alongside a processor like 
<a href="https://github.com/dciccale/grunt-processhtml"><code>processhtml</code></a> to
rewrite the location of your stylesheet to <code>tidy.css</code> using a block
like:</p>

<p><code>html
&lt;!-- build:css css/tidy.css --&gt;
&lt;link rel="stylesheet" href="css/normalize.css"&gt;
&lt;link rel="stylesheet" href="css/main.css"&gt;
&lt;link rel="stylesheet" href="css/bootstrap.css"&gt;
&lt;!-- /build --&gt;
</code></p>

<p>and some configuration like:</p>

<p><code>js
processhtml: {
  dist: {
    files: {
      'dist/index.html': ['app/index.html'],
      'dist/about.html': ['app/about.html']
    }
  }
}
</code></p>

<h2>Options</h2>

<p>Sample use of all supported options:</p>

<p><code>js
uncss: {
  dist: {
    options: {
      ignore       : ['#added_at_runtime', /test\-[0-9]+/],
      media        : ['(min-width: 700px) handheld and (orientation: landscape)'],
      csspath      : '../public/css/',
      raw          : 'h1 { color: green }',
      stylesheets  : ['lib/bootstrap/dist/css/bootstrap.css', 'src/public/css/main.css'],
      ignoreSheets : [/fonts.googleapis/],
      urls         : ['http://localhost:3000/mypage', '...'], // Deprecated
      timeout      : 1000,
      htmlroot     : 'public',
      report       : 'min'
    },
    files: {
      'dist/css/tidy.css': ['app/index.html', 'app/about.html']
    }
  }
}
</code></p>

<h3>What do the options do?</h3>

<ul>
  <li>
    <p><strong>ignore</strong> (Array): provide a list of selectors that should not be removed by UnCSS. For example, styles added by user interaction with the page (<code>hover</code>, <code>click</code>), since those are not detectable by UnCSS yet. Both literal names and regex patterns are recognized.</p>
  </li>
  <li>
    <p><strong>media</strong> (Array): by default UnCSS processes only stylesheets with media query “<em>all</em>”, “<em>screen</em>”, and those without one. Specify here which others to include.</p>
  </li>
  <li>
    <p><strong>csspath</strong> (String): path where the CSS files are related to the html files. By default, UnCSS uses the path specified in the <code>&lt;link rel="stylesheet" href="path/to/file.css"&gt;</code>.</p>
  </li>
  <li>
    <p><strong>raw</strong> (String): give the task a raw string of CSS in addition to the existing stylesheet options; useful in scripting when your CSS hasn’t yet been written to disk.</p>
  </li>
  <li>
    <p><strong>stylesheets</strong> (Array): use these stylesheets instead of those extracted from the html files.</p>
  </li>
  <li>
    <p><strong>ignoreSheets</strong> (Array):  Do not include the specified stylesheets.</p>
  </li>
  <li>
    <p><strong>urls</strong> (Array): array of URLs to load with Phantom (on top of the files already passed if any).</p>
  </li>
  <li>
    <p><strong>timeout</strong> (Number): specify how long to wait for the JS to be loaded.</p>
  </li>
  <li>
    <p><strong>htmlroot</strong> (String): where the project root is. Useful for example if you are running UnCSS on <em>local</em> files that have absolute href to the stylesheets, i.e. <code>href="/css/style.css"</code>.</p>
  </li>
  <li>
    <p><strong>report</strong> (‘min’/’gzip’): specify whether to print out only the minification result or report minification and gzip results, using <a href="https://github.com/sindresorhus/maxmin">maxmin</a>.</p>
  </li>
</ul>

<h3>Usage examples</h3>

<p><code>js
// Remove unused CSS across multiple files
uncss: {
  dist: {
    files: {
      'dist/css/tidy.css': ['app/index.html', 'app/about.html']
    }
  }
}
</code></p>

<p><code>js
// Remove unused CSS across multiple files and ignore specific selectors
uncss: {
  dist: {
    options: {
      ignore: ['#added_at_runtime', '.created_by_jQuery']
    },
    files: {
      'dist/css/tidy.css': ['app/index.html', 'app/about.html']
    }
  }
}
</code></p>

<h3>Test project</h3>

<p>There is a test project included under the <code>tests/app</code> directory which you can build by running <code>grunt</code> after an <code>npm install</code>.
It also includes a <code>grunt compare_size</code> task for getting a feel of the before and after CSS sizes:</p>

<p><img src="http://i.imgur.com/bUseCPh.png" alt="grunt compare_size" /></p>

<h2>Examples</h2>

<h3>Sites</h3>

<ul>
  <li><a href="https://github.com/h5bp/html5boilerplate.com">HTML5Boilerplate.com website</a></li>
  <li><a href="https://github.com/mozilla/dxr">Mozilla’s DXR documentation viewer</a></li>
  <li><a href="https://github.com/vanilla/vanilladocs">Vanilla forums docs site</a></li>
</ul>

<h3>Apps</h3>

<ul>
  <li><a href="https://github.com/vinitkumar/github-team-viewer">GitHub Team Viewer - Angular app</a></li>
  <li><a href="https://github.com/JeremyCarlsten/grunt-uncss-angular-example">Angular Todo application</a></li>
  <li><a href="https://github.com/carlo-colombo/CashSplitter">CashSplitter - Angular app with PouchDB, Bootstrap</a></li>
  <li><a href="https://github.com/WillsonSmith/thisWeeksComics">This Week’s Comics Express app</a></li>
  <li><a href="https://github.com/addyosmani/grunt-uncss-sass-example">Sample grunt-uncss in a Sass project</a></li>
</ul>

<h3>Other</h3>

<ul>
  <li><a href="https://github.com/sboodhoo/Grunt-UnCSS-WordPress">Using grunt-uncss with Wordpress</a></li>
  <li><a href="https://github.com/phoenixMag00/JSON-Sitemap-Generator-for-Grunt-UnCSS-with-WordPress">JSON Sitemap generator for grunt-uncss</a></li>
</ul>

<h2>The problem</h2>

<p>User-interface libraries like <a href="http://getbootstrap.com">Bootstrap</a>, <a href="http://topcoat.io">TopCoat</a>
and so on are fairly prolific, however many developers use less than 10% of the CSS they provide
(when opting for the full build, which most do). As a result, they can end up with fairly bloated
stylesheets which can significantly increase page load time and affect performance.
<code>grunt-uncss</code> is an attempt to help with by generating a CSS file containing only the CSS used
in your project, based on selector testing.</p>

<h2>Research and alternative solutions</h2>

<p>There have been many efforts to try solving the problem of finding unused CSS in the past. Opera created
<a href="https://github.com/operasoftware/ucss">ucss</a>, @aanand created (https://github.com/aanand/deadweight),
Brian Le Roux <a href="https://github.com/brianleroux/css-slap-chop">CSS Slap Chop</a> and there were a number of
client-side solutions also crafted, such as <a href="https://github.com/geuis/helium-css">Helium-CSS</a>,
<a href="https://github.com/driverdan/cssess">CSSESS</a> and the Python <a href="http://www.peterbe.com/plog/mincss">mincss</a>.</p>

<p>Unfortunately, most of these solutions don’t actually generate what you’re really after - a leaner build
of your project CSS containing only those rules you used. Finding that a more recent project called
<a href="https://github.com/giakki/uncss">UnCSS</a> did try tackling this, I set out to share some of the problems we
need to solve in this space with the developer and build a Grunt task to enable usage of it in builds more
easily.</p>

<p>Huge thanks go out to Giacomo Martino for his help with the Node module this task uses.</p>

<h2>Coverage</h2>

<ul>
  <li><a href="http://addyosmani.com/blog/removing-unused-css/">Spring-cleaning unused CSS with Grunt, Gulp &amp; other build systems</a></li>
  <li><a href="http://www.youtube.com/watch?v=833xr1MyE30">Automating the removal of unused CSS - VelocityConf</a></li>
  <li><a href="http://xdamman.com/website-optimization-grunt-uncss">Use Grunt and UnCSS to speed up the load time of your site</a></li>
  <li><a href="http://corydowdy.com/blog/foundation-5-sass-and-grunt-uncss">Foundation 5, Sass and Grunt UnCSS</a></li>
  <li><a href="https://speakerdeck.com/addyosmani/automating-front-end-workflow">Automating Front-end Workflow (slides)</a></li>
  <li><a href="http://deanhume.com/Home/BlogPost/automatically-removing-unused-css-using-grunt/6101">Automatically removing unused CSS - Windows</a></li>
  <li><a href="https://medium.com/p/32d607879082">Workflow for responsive email with Grunt and UnCSS</a></li>
</ul>

<h2>WordPress</h2>

<p>While UnCSS works best (and quickest) with static html files, it is possible to pass in
a URL array that contains all the URLs on your website, and process all used selectors that way.
<a href="https://github.com/lgladdy">@lgladdy</a> wrote a guide on how to do this
<a href="http://www.gladdy.co.uk/blog/2014/04/13/using-uncss-and-grunt-uncss-with-wordpress/">on his blog</a></p>

<h2>Notes</h2>

<p>At present we have decided to lock grunt-uncss into <a href="https://github.com/giakki/uncss/">UnCSS 0.8.1</a>. This is the most recent version we consider stable for production use. We will be reviewing future UnCSS releases and deciding to upgrade when we feel sufficient stability is back.</p>

<h2>Yeoman Generator</h2>

<p>If you’re looking for a webapp starting point with grunt-uncss integrated, see <a href="https://github.com/addyosmani/generator-webapp-uncss">generator-webapp-uncss</a>.</p>

<h2>Limitations</h2>

<p>Please note that the CSS parser used in the <code>uncss</code> module we rely on currently isn’t able to work with complex selectors.
For example <code>[data-section=''] &gt; section &gt; [data-section-title] a</code>. This may mean that at build time you run into exceptions
such as <code>TypeError: Cannot convert undefined or null to object</code>. If this is the case, please consider moving these selectors
to a separate stylesheet which the task does not run on.</p>

<p>We are actively looking at how to improve the CSS parsers used and will update this notice once this problem has been solved.</p>

<h2>Maintainers</h2>

<ul>
  <li><a href="http://github.com/addyosmani">@addyosmani</a></li>
  <li><a href="http://github.com/XhmikosR">@XhmikosR</a></li>
</ul>

<h2>License</h2>

<p>(C) Addy Osmani 2014, released under the MIT license</p>
