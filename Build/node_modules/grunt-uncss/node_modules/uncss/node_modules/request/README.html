<h1>Request – Simplified HTTP client</h1>

<p><a href="https://nodei.co/npm/request/"><img src="https://nodei.co/npm/request.png" alt="NPM" /></a></p>

<h2>Super simple to use</h2>

<p>Request is designed to be the simplest way possible to make http calls. It supports HTTPS and follows redirects by default.</p>

<p><code>javascript
var request = require('request');
request('http://www.google.com', function (error, response, body) {
  if (!error &amp;&amp; response.statusCode == 200) {
    console.log(body) // Print the google web page.
  }
})
</code></p>

<h2>Streaming</h2>

<p>You can stream any response to a file stream.</p>

<p><code>javascript
request('http://google.com/doodle.png').pipe(fs.createWriteStream('doodle.png'))
</code></p>

<p>You can also stream a file to a PUT or POST request. This method will also check the file extension against a mapping of file extensions to content-types (in this case <code>application/json</code>) and use the proper <code>content-type</code> in the PUT request (if the headers don’t already provide one).</p>

<p><code>javascript
fs.createReadStream('file.json').pipe(request.put('http://mysite.com/obj.json'))
</code></p>

<p>Request can also <code>pipe</code> to itself. When doing so, <code>content-type</code> and <code>content-length</code> are preserved in the PUT headers.</p>

<p><code>javascript
request.get('http://google.com/img.png').pipe(request.put('http://mysite.com/img.png'))
</code></p>

<p>Now let’s get fancy.</p>

<p><code>javascript
http.createServer(function (req, resp) {
  if (req.url === '/doodle.png') {
    if (req.method === 'PUT') {
      req.pipe(request.put('http://mysite.com/doodle.png'))
    } else if (req.method === 'GET' || req.method === 'HEAD') {
      request.get('http://mysite.com/doodle.png').pipe(resp)
    }
  }
})
</code></p>

<p>You can also <code>pipe()</code> from <code>http.ServerRequest</code> instances, as well as to <code>http.ServerResponse</code> instances. The HTTP method, headers, and entity-body data will be sent. Which means that, if you don’t really care about security, you can do:</p>

<p><code>javascript
http.createServer(function (req, resp) {
  if (req.url === '/doodle.png') {
    var x = request('http://mysite.com/doodle.png')
    req.pipe(x)
    x.pipe(resp)
  }
})
</code></p>

<p>And since <code>pipe()</code> returns the destination stream in ≥ Node 0.5.x you can do one line proxying. :)</p>

<p><code>javascript
req.pipe(request('http://mysite.com/doodle.png')).pipe(resp)
</code></p>

<p>Also, none of this new functionality conflicts with requests previous features, it just expands them.</p>

<p>```javascript
var r = request.defaults({‘proxy’:’http://localproxy.com’})</p>

<p>http.createServer(function (req, resp) {
  if (req.url === ‘/doodle.png’) {
    r.get(‘http://google.com/doodle.png’).pipe(resp)
  }
})
```</p>

<p>You can still use intermediate proxies, the requests will still follow HTTP forwards, etc.</p>

<h2>UNIX Socket</h2>

<p><code>request</code> supports the <code>unix://</code> protocol for all requests. The path is assumed to be absolute to the root of the host file system. </p>

<p>HTTP paths are extracted from the supplied URL by testing each level of the full URL against net.connect for a socket response.</p>

<p>Thus the following request will GET <code>/httppath</code> from the HTTP server listening on <code>/tmp/unix.socket</code></p>

<p><code>javascript
request.get('unix://tmp/unix.socket/httppath')
</code></p>

<h2>Forms</h2>

<p><code>request</code> supports <code>application/x-www-form-urlencoded</code> and <code>multipart/form-data</code> form uploads. For <code>multipart/related</code> refer to the <code>multipart</code> API.</p>

<p>URL-encoded forms are simple.</p>

<p><code>javascript
request.post('http://service.com/upload', {form:{key:'value'}})
// or
request.post('http://service.com/upload').form({key:'value'})
</code></p>

<p>For <code>multipart/form-data</code> we use the <a href="https://github.com/felixge/node-form-data">form-data</a> library by <a href="https://github.com/felixge">@felixge</a>. You don’t need to worry about piping the form object or setting the headers, <code>request</code> will handle that for you.</p>

<p><code>javascript
var r = request.post('http://service.com/upload')
var form = r.form()
form.append('my_field', 'my_value')
form.append('my_buffer', new Buffer([1, 2, 3]))
form.append('my_file', fs.createReadStream(path.join(__dirname, 'doodle.png'))
form.append('remote_file', request('http://google.com/doodle.png'))
</code></p>

<h2>HTTP Authentication</h2>

<p><code>javascript
request.get('http://some.server.com/').auth('username', 'password', false);
// or
request.get('http://some.server.com/', {
  'auth': {
    'user': 'username',
    'pass': 'password',
    'sendImmediately': false
  }
});
</code></p>

<table>
  <tbody>
    <tr>
      <td>If passed as an option, <code>auth</code> should be a hash containing values <code>user</code></td>
      <td> </td>
      <td><code>username</code>, <code>password</code></td>
      <td> </td>
      <td><code>pass</code>, and <code>sendImmediately</code> (optional).  The method form takes parameters <code>auth(username, password, sendImmediately)</code>.</td>
    </tr>
  </tbody>
</table>

<p><code>sendImmediately</code> defaults to <code>true</code>, which causes a basic authentication header to be sent.  If <code>sendImmediately</code> is <code>false</code>, then <code>request</code> will retry with a proper authentication header after receiving a <code>401</code> response from the server (which must contain a <code>WWW-Authenticate</code> header indicating the required authentication method).</p>

<p>Digest authentication is supported, but it only works with <code>sendImmediately</code> set to <code>false</code>; otherwise <code>request</code> will send basic authentication on the initial request, which will probably cause the request to fail.</p>

<h2>OAuth Signing</h2>

<p><code>javascript
// Twitter OAuth
var qs = require('querystring')
  , oauth =
    { callback: 'http://mysite.com/callback/'
    , consumer_key: CONSUMER_KEY
    , consumer_secret: CONSUMER_SECRET
    }
  , url = 'https://api.twitter.com/oauth/request_token'
  ;
request.post({url:url, oauth:oauth}, function (e, r, body) {
  // Ideally, you would take the body in the response
  // and construct a URL that a user clicks on (like a sign in button).
  // The verifier is only available in the response after a user has
  // verified with twitter that they are authorizing your app.
  var access_token = qs.parse(body)
    , oauth =
      { consumer_key: CONSUMER_KEY
      , consumer_secret: CONSUMER_SECRET
      , token: access_token.oauth_token
      , verifier: access_token.oauth_verifier
      }
    , url = 'https://api.twitter.com/oauth/access_token'
    ;
  request.post({url:url, oauth:oauth}, function (e, r, body) {
    var perm_token = qs.parse(body)
      , oauth =
        { consumer_key: CONSUMER_KEY
        , consumer_secret: CONSUMER_SECRET
        , token: perm_token.oauth_token
        , token_secret: perm_token.oauth_token_secret
        }
      , url = 'https://api.twitter.com/1.1/users/show.json?'
      , params =
        { screen_name: perm_token.screen_name
        , user_id: perm_token.user_id
        }
      ;
    url += qs.stringify(params)
    request.get({url:url, oauth:oauth, json:true}, function (e, r, user) {
      console.log(user)
    })
  })
})
</code></p>

<h3>Custom HTTP Headers</h3>

<p>HTTP Headers, such as <code>User-Agent</code>, can be set in the <code>options</code> object.
In the example below, we call the github API to find out the number
of stars and forks for the request repository. This requires a
custom <code>User-Agent</code> header as well as https.</p>

<p>```javascript
var request = require(‘request’);</p>

<p>var options = {
	url: ‘https://api.github.com/repos/mikeal/request’,
	headers: {
		‘User-Agent’: ‘request’
	}
};</p>

<p>function callback(error, response, body) {
	if (!error &amp;&amp; response.statusCode == 200) {
		var info = JSON.parse(body);
		console.log(info.stargazers_count + “ Stars”);
		console.log(info.forks_count + “ Forks”);
	}
}</p>

<p>request(options, callback);
```</p>

<h3>request(options, callback)</h3>

<p>The first argument can be either a <code>url</code> or an <code>options</code> object. The only required option is <code>uri</code>; all others are optional.</p>

<ul>
  <li>
    <table>
      <tbody>
        <tr>
          <td><code>uri</code></td>
          <td> </td>
          <td><code>url</code> - fully qualified uri or a parsed url object from <code>url.parse()</code></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li><code>qs</code> - object containing querystring values to be appended to the <code>uri</code></li>
  <li><code>method</code> - http method (default: <code>"GET"</code>)</li>
  <li><code>headers</code> - http headers (default: <code>{}</code>)</li>
  <li><code>body</code> - entity body for PATCH, POST and PUT requests. Must be a <code>Buffer</code> or <code>String</code>.</li>
  <li><code>form</code> - when passed an object, this sets <code>body</code> to a querystring representation of value, and adds <code>Content-type: application/x-www-form-urlencoded; charset=utf-8</code> header. When passed no options, a <code>FormData</code> instance is returned (and is piped to request).</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td><code>auth</code> - A hash containing values <code>user</code></td>
          <td> </td>
          <td><code>username</code>, <code>password</code></td>
          <td> </td>
          <td><code>pass</code>, and <code>sendImmediately</code> (optional).  See documentation above.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li><code>json</code> - sets <code>body</code> but to JSON representation of value and adds <code>Content-type: application/json</code> header.  Additionally, parses the response body as JSON.</li>
  <li><code>multipart</code> - (experimental) array of objects which contains their own headers and <code>body</code> attribute. Sends <code>multipart/related</code> request. See example below.</li>
  <li><code>followRedirect</code> - follow HTTP 3xx responses as redirects (default: <code>true</code>)</li>
  <li><code>followAllRedirects</code> - follow non-GET HTTP 3xx responses as redirects (default: <code>false</code>)</li>
  <li><code>maxRedirects</code> - the maximum number of redirects to follow (default: <code>10</code>)</li>
  <li><code>encoding</code> - Encoding to be used on <code>setEncoding</code> of response data. If <code>null</code>, the <code>body</code> is returned as a <code>Buffer</code>.</li>
  <li><code>pool</code> - A hash object containing the agents for these requests. If omitted, the request will use the global pool (which is set to node’s default <code>maxSockets</code>)</li>
  <li><code>pool.maxSockets</code> - Integer containing the maximum amount of sockets in the pool.</li>
  <li><code>timeout</code> - Integer containing the number of milliseconds to wait for a request to respond before aborting the request</li>
  <li><code>proxy</code> - An HTTP proxy to be used. Supports proxy Auth with Basic Auth, identical to support for the <code>url</code> parameter (by embedding the auth info in the <code>uri</code>)</li>
  <li><code>oauth</code> - Options for OAuth HMAC-SHA1 signing. See documentation above.</li>
  <li><code>hawk</code> - Options for <a href="https://github.com/hueniverse/hawk">Hawk signing</a>. The <code>credentials</code> key must contain the necessary signing info, <a href="https://github.com/hueniverse/hawk#usage-example">see hawk docs for details</a>.</li>
  <li><code>strictSSL</code> - If <code>true</code>, requires SSL certificates be valid. <strong>Note:</strong> to use your own certificate authority, you need to specify an agent that was created with that CA as an option.</li>
  <li><code>jar</code> - If <code>true</code>, remember cookies for future use (or define your custom cookie jar; see examples section)</li>
  <li><code>aws</code> - <code>object</code> containing AWS signing information. Should have the properties <code>key</code>, <code>secret</code>. Also requires the property <code>bucket</code>, unless you’re specifying your <code>bucket</code> as part of the path, or the request doesn’t use a bucket (i.e. GET Services)</li>
  <li><code>httpSignature</code> - Options for the <a href="https://github.com/joyent/node-http-signature/blob/master/http_signing.md">HTTP Signature Scheme</a> using <a href="https://github.com/joyent/node-http-signature">Joyent’s library</a>. The <code>keyId</code> and <code>key</code> properties must be specified. See the docs for other options.</li>
  <li><code>localAddress</code> - Local interface to bind for network connections.</li>
</ul>

<p>The callback argument gets 3 arguments: </p>

<ol>
  <li>An <code>error</code> when applicable (usually from <a href="http://nodejs.org/api/http.html#http_class_http_clientrequest"><code>http.ClientRequest</code></a> object)</li>
  <li>An <a href="http://nodejs.org/api/http.html#http_http_incomingmessage"><code>http.IncomingMessage</code></a> object</li>
  <li>The third is the <code>response</code> body (<code>String</code> or <code>Buffer</code>, or JSON object if the <code>json</code> option is supplied)</li>
</ol>

<h2>Convenience methods</h2>

<p>There are also shorthand methods for different HTTP METHODs and some other conveniences.</p>

<h3>request.defaults(options)</h3>

<p>This method returns a wrapper around the normal request API that defaults to whatever options you pass in to it.</p>

<h3>request.put</h3>

<p>Same as <code>request()</code>, but defaults to <code>method: "PUT"</code>.</p>

<p><code>javascript
request.put(url)
</code></p>

<h3>request.patch</h3>

<p>Same as <code>request()</code>, but defaults to <code>method: "PATCH"</code>.</p>

<p><code>javascript
request.patch(url)
</code></p>

<h3>request.post</h3>

<p>Same as <code>request()</code>, but defaults to <code>method: "POST"</code>.</p>

<p><code>javascript
request.post(url)
</code></p>

<h3>request.head</h3>

<p>Same as request() but defaults to <code>method: "HEAD"</code>.</p>

<p><code>javascript
request.head(url)
</code></p>

<h3>request.del</h3>

<p>Same as <code>request()</code>, but defaults to <code>method: "DELETE"</code>.</p>

<p><code>javascript
request.del(url)
</code></p>

<h3>request.get</h3>

<p>Same as <code>request()</code> (for uniformity).</p>

<p><code>javascript
request.get(url)
</code>
### request.cookie</p>

<p>Function that creates a new cookie.</p>

<p><code>javascript
request.cookie('cookie_string_here')
</code>
### request.jar</p>

<p>Function that creates a new cookie jar.</p>

<p><code>javascript
request.jar()
</code></p>

<h2>Examples:</h2>

<p><code>javascript
  var request = require('request')
    , rand = Math.floor(Math.random()*100000000).toString()
    ;
  request(
    { method: 'PUT'
    , uri: 'http://mikeal.iriscouch.com/testjs/' + rand
    , multipart:
      [ { 'content-type': 'application/json'
        ,  body: JSON.stringify({foo: 'bar', _attachments: {'message.txt': {follows: true, length: 18, 'content_type': 'text/plain' }}})
        }
      , { body: 'I am an attachment' }
      ]
    }
  , function (error, response, body) {
      if(response.statusCode == 201){
        console.log('document saved as: http://mikeal.iriscouch.com/testjs/'+ rand)
      } else {
        console.log('error: '+ response.statusCode)
        console.log(body)
      }
    }
  )
</code></p>

<p>Cookies are disabled by default (else, they would be used in subsequent requests). To enable cookies, set <code>jar</code> to <code>true</code> (either in <code>defaults</code> or <code>options</code>).</p>

<p><code>javascript
var request = request.defaults({jar: true})
request('http://www.google.com', function () {
  request('http://images.google.com')
})
</code></p>

<p>To use a custom cookie jar (instead <code>request</code>’s global cookie jar), set <code>jar</code> to an instance of <code>request.jar()</code> (either in <code>defaults</code> or <code>options</code>)</p>

<p><code>javascript
var j = request.jar()
var request = request.defaults({jar:j})
request('http://www.google.com', function () {
  request('http://images.google.com')
})
</code></p>

<p>OR</p>

<p><code>javascript
var j = request.jar()
var cookie = request.cookie('your_cookie_here')
j.setCookie(cookie, uri);
request({url: 'http://www.google.com', jar: j}, function () {
  request('http://images.google.com')
})
</code></p>
